// compressed @ http://closure-compiler.appspot.com/home
var atomList=[],bondList=[],l8=[[-25,100],[25,100],[100,25],[100,-25],[25,-100],[-25,-100],[-100,-25],[-100,25]],l4=[[58,25],[58,-25],[-58,-25],[-58,25]],l2=[[50,0],[-50,0]],mode=0;
function changeMode(){mode=(mode+1)%3;if(0==mode){document.getElementById("mode").innerHTML="Chem";$("#mode").switchClass("teal","yellow",200);for(var c=0;c<atomList.length;c++){var a=atomList[c];document.getElementById(a.id+"-text").innerHTML=a.atom}}else{for(c=0;c<atomList.length;c++)a=atomList[c],document.getElementById(a.id+"-text").innerHTML="";1==mode?(document.getElementById("mode").innerHTML="Mult",$("#mode").switchClass("yellow","pink",200)):2==mode&&(document.getElementById("mode").innerHTML=
"Add",$("#mode").switchClass("pink","teal",200))}if(mode)for(c=0;c<atomList.length;c++)for(a=0;a<atomList[c].lights.length;a++){var b=atomList[c].lights[a];document.getElementById(b.id).innerHTML=a}else for(c=0;c<atomList.length;c++)for(a=0;a<atomList[c].lights.length;a++)b=atomList[c].lights[a],document.getElementById(b.id).innerHTML=""}
function check(){if("Clear"==document.getElementById("check").innerHTML){document.getElementById("check").innerHTML="Check";document.getElementById("result").innerHTML="";$("#result").switchClass("green","grey",200);for(var c=0;c<atomList.length;c++){var a=atomList[c];mode&&(document.getElementById(a.id+"-text").innerHTML="");for(var b=0;b<a.lights.length;b++)a.lights[b].on&&switchLight(a.lights[b].id)}}else 0==mode?c=chem():1==mode?c=mult():2==mode&&(c=add()),c?(document.getElementById("result").innerHTML=
"Correct!",document.getElementById("check").innerHTML="Clear",$("#result").switchClass("grey","green",200)):document.getElementById("result").innerHTML="Incorrect"}
function checkBonds(){for(var c=[],a=0;a<bondList.length;a++){var b=bondList[a];document.getElementById(b.id);var f=document.getElementById(b.atom1.id),d=Number(f.style.left.substring(0,f.style.left.search("px"))),f=Number(f.style.top.substring(0,f.style.top.search("px"))),e=document.getElementById(b.atom2.id),g=Number(e.style.left.substring(0,e.style.left.search("px"))),e=Number(e.style.top.substring(0,e.style.top.search("px"))),b=Math.atan2(f+b.atom1.radius-(e+b.atom2.radius),d+b.atom1.radius-(g+
b.atom2.radius)),b=0<b?b:b+2*Math.PI;c[c.length]=b}c=Math.abs(Math.abs(c[0])-Math.abs(c[1]));return 1.62<c&&2.02>c?!0:!1}function chem(){for(var c=[[0,0,1,1,1,1,1,1],[0,1,0,0],[0,0,1,0]],a=!0,b=0;b<atomList.length;b++)for(var f=atomList[b],d=c[b],e=0;e<f.lights.length;e++)if(d[e]!=f.lights[e].on){a=!1;break}return a?(a*=checkBonds())?!0:!1:!1}
function mult(){for(var c=[],a=0;a<atomList.length;a++){for(var b=atomList[a],f=0,d=0;d<b.lights.length;d++)f+=Math.pow(2,d)*b.lights[d].on;document.getElementById(b.id+"-text").innerHTML=f;c[c.length]=f}for(a=b=1;a<c.length;a++)b*=c[a];return b==c[0]?!0:!1}
function add(){for(var c=[],a=0;a<atomList.length;a++){for(var b=atomList[a],f=0,d=0;d<b.lights.length;d++)f+=Math.pow(2,d)*b.lights[d].on;document.getElementById(b.id+"-text").innerHTML=f;c[c.length]=f}b=0;for(a=1;a<c.length;a++)b+=c[a];return b==c[0]?!0:!1}function Light(c,a){this.id=c;this.color=a;this.on=0}
function switchLight(c){for(var a=0;a<atomList.length;a++)if(atomList[a].id==c.substring(0,c.indexOf("-"))){var b=atomList[a].lights[Number(c.substring(c.indexOf("-l")+2))];b.on?($("#"+c).switchClass(b.color,"grey",200),b.on=0):($("#"+c).switchClass("grey",b.color,100),b.on=1)}}function Atom(c,a,b,f,d,e,g){this.id=c;this.color=a;this.radius=8===f?150:100;this.atom=d;this.dx=e;this.dy=g;this.lcolor=b;this.numLights=f;this.lights=[]}function Bond(c,a){this.id;this.atom1=c;this.atom2=a}
function changeBond(c){for(var a=0;a<bondList.length;a++){var b=bondList[a];if(c==b.atom1.id||c==b.atom2.id){var f=document.getElementById(b.id),d=document.getElementById(b.atom1.id),e=Number(d.style.left.substring(0,d.style.left.search("px"))),g=Number(d.style.top.substring(0,d.style.top.search("px"))),d=document.getElementById(b.atom2.id),h=Number(d.style.left.substring(0,d.style.left.search("px"))),j=Number(d.style.top.substring(0,d.style.top.search("px"))),k=e+b.atom1.radius-(h+b.atom2.radius),
l=g+b.atom1.radius-(j+b.atom2.radius),d=Math.atan2(l,k),e=Math.min(e+b.atom1.radius,h+b.atom2.radius),b=Math.min(g+b.atom1.radius,j+b.atom2.radius),g=Math.sqrt(Math.pow(k,2)+Math.pow(l,2));f.style.width=g+"px";f.style.transform="rotate("+d+"rad)";f.style.webkitTransform="rotate("+d+"rad)";Math.abs(25*Math.cos(d));d=Math.abs(Math.sin(d)*g);f.style.left=e-NaN;f.style.top=b+d/2+"px"}}}
function display(){var c=document.getElementById("canvas");c.setAttribute("height",$(window).height());c.setAttribute("width",900>$(window).width()?900:$(window).width());var a=c.getAttribute("width")/2,b=(c.getAttribute("height")-51)/2;document.getElementById("mode").style.top=$(window).height()-51+"px";document.getElementById("check").style.top=$(window).height()-51+"px";document.getElementById("result").style.top=$(window).height()-51+"px";oxygen=new Atom("O","tomato","lemon",8,"O",0,0);helium1=
new Atom("H1","plum","cyan",4,"H",-300,0);helium2=new Atom("H2","plum","magenta",4,"H",300,0);atomList=[oxygen,helium1,helium2];for(var f=0;f<atomList.length;f++){var d=atomList[f],e=document.createElement("div");e.id=d.id;e.style.left=a+d.dx-d.radius+"px";e.style.top=b+d.dy-d.radius+"px";e.style.position="absolute";var g=" atom "+d.color+" ",g=g+(150===d.radius?"atom-large":"atom-small");e.setAttribute("class",g);c.appendChild(e);$(".atom").draggable({stop:function(){changeBond(this.id)}})}for(f=
0;3>f;f++){d=atomList[f];e=document.getElementById(d.id);e.style.left.substring(0,e.style.left.search("px"));e.style.top.substring(0,e.style.top.search("px"));var h;2==d.numLights?h=l2:4==d.numLights?h=l4:8==d.numLights&&(h=l8);for(a=0;a<d.numLights;a++)b=d.id+"-l"+a,g=new Light(b,d.lcolor),d.lights[d.lights.length]=g,g=document.createElement("button"),g.id=b,e.appendChild(g),g.style.left=d.radius+h[a][0]-12+"px",g.style.top=d.radius+h[a][1]-12+"px",g.style.position="absolute",g.setAttribute("class",
"grey light"),$("#"+b).button(),$(".light").unbind("click").click(function(){switchLight(this.id)});a=document.createElement("button");a.id=d.id+"-text";e.appendChild(a);a.style.left=d.radius-20+"px";a.style.top=d.radius-25+"px";a.style.position="absolute";a.setAttribute("class","num-text grey");a.disabled=!0;$("#"+d.id+"-text").button()}bond1=new Bond(oxygen,helium1);bond2=new Bond(oxygen,helium2);bondList=[bond1,bond2];for(f=0;f<bondList.length;f++)d=bondList[f],d.id="bond"+f,e=document.getElementById(d.atom1.id),
h=Number(e.style.left.substring(0,e.style.left.search("px"))),a=Number(e.style.top.substring(0,e.style.top.search("px"))),e=document.getElementById(d.atom2.id),b=Number(e.style.left.substring(0,e.style.left.search("px"))),g=Number(e.style.top.substring(0,e.style.top.search("px"))),e=Math.abs(h+d.atom1.radius-(b+d.atom2.radius)),Math.abs(a+d.atom1.radius-(g+d.atom2.radius)),h=h<b?h+d.atom1.radius:b+d.atom2.radius,d=a<g?a+d.atom1.radius:g+d.atom2.radius,a=document.createElement("div"),a.id="bond"+f,
a.style.width=e+20+"px",a.style.height="50px",a.style.left=h-10+"px",a.style.top=d-25+"px",a.style.position="absolute",a.style.zIndex=-10,a.setAttribute("class","grey"),c.appendChild(a);changeMode()};